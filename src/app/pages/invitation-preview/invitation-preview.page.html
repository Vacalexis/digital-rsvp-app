@if (event(); as currentEvent) {
<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="'/events/' + eventId()"></ion-back-button>
    </ion-buttons>
    <ion-title>Pr√©-visualiza√ß√£o</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="shareInvitation()">
        <ion-icon slot="icon-only" name="share-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <app-invitation-card
    [event]="currentEvent"
    [showEnvelope]="true"
    [showCountdown]="true"
    [showSchedule]="true"
  >
    <div class="rsvp-form preview">
      <h2>Confirma a tua presen√ßa</h2>

      <!-- Preview Mode Selector -->
      <div class="preview-mode-selector">
        <label>Simular tipo de convite:</label>
        <ion-segment
          [(ngModel)]="previewMode"
          (ionChange)="onPreviewModeChange()"
        >
          <ion-segment-button value="single">
            <ion-label>Individual</ion-label>
          </ion-segment-button>
          <ion-segment-button value="couple">
            <ion-label>Casal</ion-label>
          </ion-segment-button>
          <ion-segment-button value="family">
            <ion-label>Fam√≠lia</ion-label>
          </ion-segment-button>
        </ion-segment>
      </div>

      <!-- Personalized Greeting (simulated) -->
      <div class="personalized-greeting">
        @if (previewMode === 'single' || previewMode === 'single-plus-one') {
        <p class="greeting">
          Ol√° <strong>{{ simulatedPrimaryName }}</strong>,
        </p>
        <p class="greeting-sub">Est√°s convidado/a para o nosso evento!</p>
        } @else if (previewMode === 'couple') {
        <p class="greeting">
          Ol√° <strong>{{ simulatedPrimaryName }}</strong> &
          <strong>{{ simulatedSecondaryName }}</strong>,
        </p>
        <p class="greeting-sub">Est√£o convidados para o nosso evento!</p>
        } @else if (previewMode === 'family') {
        <p class="greeting">
          Ol√° <strong>{{ simulatedPrimaryName }}</strong> &
          <strong>{{ simulatedSecondaryName }}</strong> (+{{
          simulatedChildrenCount }} filhos),
        </p>
        <p class="greeting-sub">Est√£o convidados para o nosso evento!</p>
        }
      </div>

      <!-- RSVP Form - Different layout for couples -->
      @if (previewMode === 'couple' || previewMode === 'family') {
      <!-- Couple/Family Mode: Both guests respond together -->
      <div class="couple-rsvp-section">
        <div class="guest-card">
          <h4>{{ simulatedPrimaryName }}</h4>
          <div class="radio-options compact">
            <div
              class="radio-option"
              [class.selected]="attendingPreview === 'yes'"
              (click)="attendingPreview = 'yes'"
            >
              <ion-icon
                name="checkmark-circle-outline"
                color="success"
              ></ion-icon>
              <span>Sim</span>
            </div>
            <div
              class="radio-option"
              [class.selected]="attendingPreview === 'no'"
              (click)="attendingPreview = 'no'"
            >
              <ion-icon name="close-circle-outline" color="danger"></ion-icon>
              <span>N√£o</span>
            </div>
          </div>
        </div>

        <div class="guest-card">
          <h4>{{ simulatedSecondaryName }}</h4>
          <div class="radio-options compact">
            <div
              class="radio-option"
              [class.selected]="secondaryAttendingPreview"
              (click)="secondaryAttendingPreview = true"
            >
              <ion-icon
                name="checkmark-circle-outline"
                color="success"
              ></ion-icon>
              <span>Sim</span>
            </div>
            <div
              class="radio-option"
              [class.selected]="!secondaryAttendingPreview"
              (click)="secondaryAttendingPreview = false"
            >
              <ion-icon name="close-circle-outline" color="danger"></ion-icon>
              <span>N√£o</span>
            </div>
          </div>
        </div>
      </div>
      } @else {
      <!-- Single Mode -->
      <div class="form-group">
        <label>Vai poder estar presente?</label>
        <div class="radio-options">
          <div
            class="radio-option"
            [class.selected]="attendingPreview === 'yes'"
            (click)="attendingPreview = 'yes'"
          >
            <ion-icon
              name="checkmark-circle-outline"
              color="success"
            ></ion-icon>
            <span>Sim, estarei presente!</span>
          </div>
          <div
            class="radio-option"
            [class.selected]="attendingPreview === 'no'"
            (click)="attendingPreview = 'no'"
          >
            <ion-icon name="close-circle-outline" color="danger"></ion-icon>
            <span>Infelizmente n√£o poderei</span>
          </div>
          <div
            class="radio-option"
            [class.selected]="attendingPreview === 'maybe'"
            (click)="attendingPreview = 'maybe'"
          >
            <ion-icon name="help-circle-outline" color="medium"></ion-icon>
            <span>Ainda n√£o sei</span>
          </div>
        </div>
      </div>
      }

      <!-- Dietary restrictions for couple mode -->
      @if ((previewMode === 'couple' || previewMode === 'family') &&
      currentEvent.askDietaryRestrictions) { 
        @if (attendingPreview === 'yes') {
        <div class="form-group">
          <label>Restri√ß√µes alimentares de {{ simulatedPrimaryName }}</label>
          <app-dietary-select [(ngModel)]="primaryDietary"></app-dietary-select>
        </div>
        } 
        @if (secondaryAttendingPreview) {
        <div class="form-group">
          <label>Restri√ß√µes alimentares de {{ simulatedSecondaryName }}</label>
          <app-dietary-select [(ngModel)]="secondaryDietary"></app-dietary-select>
        </div>
        } 
      }

      <!-- Plus One (for single types) -->
      @if (attendingPreview === 'yes' && showPlusOneOption()) {
      <div class="form-group">
        <ion-item lines="none" class="toggle-item">
          <ion-toggle [(ngModel)]="bringingPlusOnePreview"
            >Vou levar acompanhante</ion-toggle
          >
        </ion-item>
        @if (bringingPlusOnePreview) {
        <ion-input
          [(ngModel)]="plusOneNamePreview"
          placeholder="Nome do acompanhante"
          fill="outline"
          class="plus-one-input"
        >
        </ion-input>

        @if (currentEvent.askDietaryRestrictions) {
        <div class="plus-one-dietary">
          <label>Restri√ß√µes alimentares do acompanhante</label>
          <app-dietary-select [(ngModel)]="plusOneDietary"></app-dietary-select>
        </div>
        } }
      </div>
      }

      <!-- Children Section (Family mode) -->
      @if (showChildrenSection()) {
      <div class="form-group children-section">
        <label>Quantos filhos v√£o estar presentes?</label>
        <ion-select
          [(ngModel)]="childrenAttendingPreview"
          interface="popover"
          fill="outline"
        >
          @for (i of getChildrenOptions(); track i) {
          <ion-select-option [value]="i">{{ i }}</ion-select-option>
          }
        </ion-select>

        @if (childrenAttendingPreview > 0 &&
        currentEvent.askDietaryRestrictions) {
        <div class="children-dietary">
          <label>Restri√ß√µes alimentares das crian√ßas</label>
          <app-dietary-select [(ngModel)]="childrenDietary"></app-dietary-select>
        </div>
        }
      </div>
      }

      <!-- Primary Guest Dietary (when attending in single mode) -->
      @if (attendingPreview === 'yes' && currentEvent.askDietaryRestrictions && !showSecondaryGuest()) {
      <div class="form-group">
        <label>Restri√ß√µes alimentares ou alergias</label>
        <app-dietary-select [(ngModel)]="primaryDietary"></app-dietary-select>
      </div>
      } 
      
      @if (attendingPreview === 'yes' && currentEvent.askSongRequest) {
      <div class="form-group">
        <label>Sugest√£o de m√∫sica üéµ</label>
        <ion-input
          [(ngModel)]="songRequestPreview"
          placeholder="Qual m√∫sica n√£o pode faltar?"
          fill="outline"
        >
        </ion-input>
      </div>
      }

      <div class="form-group">
        <label>Mensagem para os anfitri√µes</label>
        <ion-textarea
          [(ngModel)]="messagePreview"
          placeholder="Deixe uma mensagem..."
          fill="outline"
          [autoGrow]="true"
          rows="3"
        >
        </ion-textarea>
      </div>

      <ion-button expand="block" class="submit-button" disabled>
        Confirmar Resposta (pr√©-visualiza√ß√£o)
      </ion-button>

      <ion-button
        expand="block"
        fill="outline"
        class="open-real-button"
        [href]="'/rsvp/' + currentEvent.shareCode"
        target="_blank"
        rel="noopener"
      >
        Abrir RSVP real
      </ion-button>

      @if (currentEvent.rsvpDeadline) {
      <p class="deadline">
        Responde at√© {{ formatDate(currentEvent.rsvpDeadline) }}
      </p>
      }
    </div>
  </app-invitation-card>
</ion-content>
} @else {
<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/events"></ion-back-button>
    </ion-buttons>
    <ion-title>Convite n√£o encontrado</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <p>O convite n√£o foi encontrado.</p>
</ion-content>
}
