<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Escolher Tema</ion-title>
  </ion-toolbar>

  <!-- Search Bar -->
  <ion-toolbar>
    <ion-searchbar
      [value]="searchTerm()"
      (ionInput)="onSearchChange($event)"
      placeholder="Pesquisar temas..."
      animated="true"
      [debounce]="300"
    ></ion-searchbar>
  </ion-toolbar>

  <!-- Category Filters -->
  <ion-toolbar class="category-toolbar">
    <div class="category-filters">
      <ion-chip
        [class.active]="selectedCategory() === 'all'"
        (click)="selectCategory('all')"
      >
        <ion-icon name="sparkles-outline"></ion-icon>
        <ion-label>Todos</ion-label>
      </ion-chip>

      <ion-chip
        [class.active]="selectedCategory() === 'classic'"
        (click)="selectCategory('classic')"
      >
        <ion-icon name="ribbon-outline"></ion-icon>
        <ion-label>Clássicos</ion-label>
      </ion-chip>

      <ion-chip
        [class.active]="selectedCategory() === 'modern'"
        (click)="selectCategory('modern')"
      >
        <ion-icon name="diamond-outline"></ion-icon>
        <ion-label>Modernos</ion-label>
      </ion-chip>

      <ion-chip
        [class.active]="selectedCategory() === 'nature'"
        (click)="selectCategory('nature')"
      >
        <ion-icon name="leaf-outline"></ion-icon>
        <ion-label>Natureza</ion-label>
      </ion-chip>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="themes-content">
  <!-- Results Header -->
  <div class="results-header">
    <h2>
      @if (filteredThemes().length === themes.length) {
        Todos os Temas
      } @else {
        {{ filteredThemes().length }} 
        {{ filteredThemes().length === 1 ? 'tema encontrado' : 'temas encontrados' }}
      }
    </h2>
    <p class="subtitle">Escolha o tema perfeito para o seu evento</p>
  </div>

  <!-- Themes Grid -->
  <ion-grid class="themes-grid">
    <ion-row>
      @for (theme of filteredThemes(); track theme.id) {
        <ion-col size="12" size-sm="6" size-md="4" size-lg="3">
          <ion-card
            class="theme-card"
            [style.--theme-color]="theme.color"
            button="true"
            (click)="navigateToPreview(theme.id)"
          >
            <!-- Theme Preview -->
            <div class="theme-preview">
              <div class="theme-crest">
                <div class="crest-icon">{{ theme.crestIcon }}</div>
              </div>
              <h3>{{ theme.name }}</h3>
            </div>

            <!-- Theme Info -->
            <ion-card-content>
              <p class="theme-description">{{ theme.description }}</p>

              <!-- Category Badge -->
              <div class="theme-meta">
                <ion-chip class="category-chip">
                  <ion-icon [name]="getCategoryIcon(theme.category)"></ion-icon>
                  <ion-label>{{ getCategoryLabel(theme.category) }}</ion-label>
                </ion-chip>
              </div>

              <!-- Tags -->
              <div class="theme-tags">
                @for (tag of theme.tags.slice(0, 3); track tag) {
                  <span class="tag">{{ tag }}</span>
                }
              </div>

              <!-- CTA -->
              <ion-button
                expand="block"
                class="preview-button"
                (click)="navigateToPreview(theme.id); $event.stopPropagation()"
              >
                <ion-icon name="search-outline" slot="start"></ion-icon>
                Pré-visualizar
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>
      } @empty {
        <!-- No Results -->
        <ion-col size="12">
          <div class="no-results">
            <ion-icon name="search-outline"></ion-icon>
            <h3>Nenhum tema encontrado</h3>
            <p>
              Tente ajustar a sua pesquisa ou filtros para encontrar o tema
              perfeito.
            </p>
            <ion-button (click)="searchTerm.set(''); selectCategory('all')">
              Limpar Filtros
            </ion-button>
          </div>
        </ion-col>
      }
    </ion-row>
  </ion-grid>

  <!-- Help Section -->
  <div class="help-section">
    <ion-card>
      <ion-card-content>
        <div class="help-content">
          <ion-icon name="sparkles-outline" class="help-icon"></ion-icon>
          <div>
            <h4>Não consegue decidir?</h4>
            <p>
              Todos os temas podem ser totalmente personalizados com as suas
              cores, textos e detalhes do evento.
            </p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
